{
    "builders": [
        {
            "region": "{{user `region`}}",
            "ami_name": "r3d-kali-{{timestamp}}",
            "instance_type": "{{user `instance_type`}}",
            "source_ami_filter": {
                "filters": {
                    "name": "Kali Linux*",
                    "virtualization-type": "hvm"
                },
                "most_recent": true,
                "owners": "amazon"
            },
            "ssh_username": "kali",
            "type": "amazon-ebs",
            "tags": {
                "Name": "{{user `name`}}",
                "description": "{{user `description`}}",
                "builder": "{{user `builder`}}"
            }
        }
    ],
    "provisioners": [
        {
            "type": "shell",
            "environment_vars": "DEBIAN_FRONTEND=noninteractive",
            "execute_command": "sudo -S env {{ .Vars }} {{ .Path }}",
            "inline": [
                "apt update && upgrade && apt dist-upgrade -y",
                "apt-get install python3 software-properties-common jq curl unzip ansible -y"
            ]
        }
    ],
    "post-processors": [
        {
            "type": "manifest",
            "output": "manifest.json",
            "strip_path": true
        }
    ]
}